import{r as I,c,h,H as g,g as u}from"./index-DX4l-cVo.js";import{T as f}from"./modus-content-tree.constants-b1c2cf71-Ddv897wd.js";const p=({draggingState:e,size:t})=>{if(!e)return null;const{width:s,translation:i,dragContent:n,validTarget:r,targetId:o}=e,d={width:s,transform:`translate(calc(${i.x}px - 10%), calc(${i.y}px - 50%))`,msTransform:`translateX(${i.x}px) translateX(-10%) translateY(${i.y}px) translateY(-50%)`},a=`${f.get(t||"standard")}`,m=`drag-content${o&&!r?" drop-block":" drop-allow"} ${a}`;return h("div",{style:Object.assign({},d),ref:l=>l&&l.appendChild(n),class:m})},b='.drag-content{cursor:grabbing !important;left:0;opacity:0.9;position:fixed;top:0;z-index:99999}.drag-content .tree-item{align-items:center;background-color:var(--modus-tree-view-item-bg, #fff);border:0.0625rem solid var(--modus-tree-view-item-border-color, #e0e1e9);color:var(--modus-tree-view-item-color, #252a2e);display:flex;font-family:"Open Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-size:1rem;height:2.375rem;width:100%}.drag-content .tree-item .icon-slot{visibility:hidden}.drag-content .tree-item.large{height:2.875rem}.drag-content .tree-item.small{font-size:0.75rem;height:1.875rem}.drag-content.drop-allow .tree-item{border:2px dashed var(--modus-tree-view-item-drag-border-color, #217cbb) !important}.drag-content.drop-block .tree-item{border:2px dashed var(--modus-tree-view-item-drag-error-border-color, #da212c) !important}:host{display:block}ul{padding:0}',S=b;var x=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(s[i[n]]=e[i[n]]);return s};const v=class{constructor(e){I(this,e),this.itemDrop=c(this,"itemDrop"),this.itemSelectionChange=c(this,"itemSelectionChange"),this.itemActionClick=c(this,"itemActionClick"),this.anchorItemId=null,this.items={},this.syncItems=[],this.onMouseMove=t=>this.handleItemDragOver(t),this.onMouseUp=()=>this.handleItemDrop(),this.onKeyDown=t=>this.handleArrowKeys(t),this.INITIAL_DRAG_POSITION={x:0,y:0},this.checkboxSelection=void 0,this.checkedItems=[],this.disableTabbing=void 0,this.enableReordering=void 0,this.expandedItems=[],this.multiCheckboxSelection=void 0,this.multiSelection=void 0,this.selectedItems=[],this.size="standard",this.borderless=void 0,this.itemDragState=void 0,this.isDraggingWithKeyboard=void 0}clearItemDropState(){if(!this.itemDragState)return null;const e=this.itemDragState,{targetId:t}=e,s=x(e,["targetId"]);return t&&(this.items[t].content.classList.remove("drop-allow"),this.items[t].content.classList.remove("drop-block")),Object.assign(Object.assign({},s),{targetId:null,validTarget:null})}handleDocumentClick(e){this.element.contains(e.target)||e.defaultPrevented||(this.focusItem=null)}handleItemDragState(e,t){t&&e&&t.itemId===e.itemId||(e?(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)):(document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)))}handleDraggingWithKeyboard(e){e?document.addEventListener("keydown",this.onKeyDown):document.removeEventListener("keydown",this.onKeyDown)}handleItemDragStart(e,t,s){const{clientX:i,clientY:n,currentTarget:r}=s,o=r==null?void 0:r.parentElement,d={x:i,y:n};this.clearItemDropState(),this.itemDragState={dragContent:t,origin:d,translation:d,itemId:e,width:`${o==null?void 0:o.offsetWidth}px`,height:`${o==null?void 0:o.offsetHeight}px`}}handleItemDragStartKeyboard(e,t,s){if(s.code==="Escape"&&this.itemDragState&&(t.style.transform=`translate(${this.INITIAL_DRAG_POSITION.x}px, ${this.INITIAL_DRAG_POSITION.y}px)`,this.clearItemDropState(),this.itemDragState=null),s.code==="Enter")if(this.currentItem=null,this.isDraggingWithKeyboard)this.handleItemDrop(),this.isDraggingWithKeyboard=!1;else{const{currentTarget:i}=s,n=i==null?void 0:i.parentElement,r=n.getBoundingClientRect().x,o=n.getBoundingClientRect().y,d={x:r+40,y:o+20};this.clearItemDropState(),this.itemDragState={dragContent:t,origin:d,translation:d,itemId:e,width:`${n==null?void 0:n.offsetWidth}px`,height:`${n==null?void 0:n.offsetHeight}px`},this.isDraggingWithKeyboard=!0}}handleKeys(e,t=!1){e===1?this.currentItem=this.items[this.getNextNavigableItem(this.currentItem.nodeId,t)]:this.currentItem=this.items[this.getPrevNavigableItem(this.currentItem.nodeId,t)]}handleArrowKeys(e){if(!this.itemDragState)return;const t=e.key==="ArrowUp"?-1:e.key==="ArrowDown"?1:0;if(t===0)return;this.currentItem||(this.currentItem=this.items[this.itemDragState.itemId]),this.handleKeys(t),t==1?(this.currentItem==this.items[this.getNextNavigableItem(this.itemDragState.itemId)]&&this.handleKeys(t),this.currentItem==this.items[this.itemDragState.itemId]&&this.handleKeys(t,!0)):this.currentItem==this.items[this.getNextNavigableItem(this.itemDragState.itemId)]&&this.handleKeys(t,!0);let s=Object.assign({},this.clearItemDropState());if(this.currentItem.nodeId&&this.currentItem.nodeId!==s.itemId){const i=this.getParentIds(this.currentItem.nodeId);s=Object.assign(Object.assign({},s),{targetId:this.currentItem.nodeId}),this.currentItem.element.droppableItem&&!this.isItemDisabled(this.currentItem.nodeId)&&!(i&&i.includes(s.itemId))?(s.validTarget=!0,this.currentItem.content.classList.add("drop-allow")):(s.validTarget=!1,this.currentItem.content.classList.add("drop-block"))}this.itemDragState=Object.assign({},s)}handleItemDragOver(e){if(!this.itemDragState)return;const{clientX:t,clientY:s}=e,i={x:t,y:s},{nodeId:n,element:r,content:o}=this.getItemWithinBounds(t,s)||{};let d=Object.assign(Object.assign({},this.clearItemDropState()),{translation:i});if(n&&n!==d.itemId){const a=this.getParentIds(n);d=Object.assign(Object.assign({},d),{targetId:n}),r.droppableItem&&!this.isItemDisabled(n)&&!(a&&a.includes(d.itemId))?(d.validTarget=!0,o.classList.add("drop-allow")):(d.validTarget=!1,o.classList.add("drop-block"))}this.itemDragState=Object.assign({},d)}handleItemDrop(){var e;if(!this.itemDragState)return;const{itemId:t,targetId:s,validTarget:i}=this.itemDragState;if(t&&i&&t!==s){const{parentId:n,element:r}=this.items[s];if(r){const o=((e=this.items[n])===null||e===void 0?void 0:e.element)||this.element,d=r,a=this.items[this.itemDragState.itemId].element;o.insertBefore(a,d),this.itemDrop.emit(this.items)}}this.clearItemDropState(),this.itemDragState=null}handleItemsProps(e,t){this.syncItems.push(...t||[],...e||[])}handleOptionsProps(){const e=this.getTreeViewItemOptions();Object.values(this.items).forEach(({element:t})=>{t.initTreeViewItem(e)})}handleTreeSlotChange(){Array.from(this.element.children).map(t=>t.nodeId).filter(t=>t).forEach((t,s)=>{this.updateItem({nodeId:t,index:s,parentId:null})})}getItemWithinBounds(e,t){return Object.values(this.items).find(({content:i})=>{const n=i==null?void 0:i.getBoundingClientRect();if(n){const r=t>=n.top&&t<=n.bottom,o=e>=n.left&&e<=n.right;return r&&o}return!1})}getParentIds(e){if(!e)return[];const{parentId:t}=this.items[e];return t?[t,...this.getParentIds(t)]:[]}addItem(e){const t=e,s=e.parentNode;if(t.nodeId){const{children:i,nodeId:n}=s,r=Array.from(i).filter(d=>d.nodeId).indexOf(t),o=this.getLevel(n)+1;this.items[t.nodeId]=Object.assign(Object.assign({},this.items[t.nodeId]),{nodeId:t.nodeId,index:r,element:t,disabled:t.disabled,parentId:n,level:o}),t.initTreeViewItem(this.getTreeViewItemOptions())}}componentDidUpdate(){var e;(e=this.syncItems)===null||e===void 0||e.forEach(t=>this.syncTreeViewItem(t)),this.syncItems=[]}deleteItem(e){const t=this.items[e];let s=[];if(t){t.children.forEach(n=>{delete this.items[n],s.push(n)}),delete this.items[e],s.push(e);const i=n=>n.find(r=>s.includes(r))?n.filter(r=>!s.includes(r)):n;this.checkedItems=i(this.checkedItems),this.selectedItems=i(this.selectedItems),this.expandedItems=i(this.expandedItems),s.includes(this.focusItem)&&(this.focusItem=null)}}getChildrenIds(e,t=!0){var s;const i=(s=this.items[e])===null||s===void 0?void 0:s.children;return i?Array.from(i).map(n=>this.items[n]).sort((n,r)=>n.index-r.index).reduce((n,r)=>(n.push(r.nodeId,...t?this.getChildrenIds(r.nodeId,t):[]),n),[]):[]}getLevel(e){var t;return((t=this.items[e])===null||t===void 0?void 0:t.level)||0}getFirstItem(){const e=this.element.firstElementChild;return e?e.nodeId:null}getLastItem(){const e=this.element.lastElementChild;if(e){const t=e;let s=t.nodeId;return this.isItemExpanded(t.nodeId)&&(s=this.getChildrenIds(t.nodeId,!0).slice(-1)[0]),s}return null}getNavigableChildrenIds(e){let t=[];return e?t=this.getChildrenIds(e,!1):t=Object.values(this.items).filter(s=>!s.parentId).sort((s,i)=>s.index-i.index).map(s=>s.nodeId),t.filter(s=>!this.isItemDisabled(s))}getNextNavigableItem(e,t=!1){if(this.isItemExpanded(e)){const i=this.getNavigableChildrenIds(e);if(i.length)return i[0]}let s=this.items[e];for(;s!=null;){const i=this.getNavigableChildrenIds(s.parentId),n=i.indexOf(s.nodeId),r=t?n+2:n+1,o=i[r];if(o)return o;s=this.items[s.parentId]}return e}getPrevNavigableItem(e,t=!1){const s=this.items[e],i=this.getNavigableChildrenIds(s.parentId),n=i.indexOf(e);if(n===0)return s.parentId||e;let r=t?n-2:n-1;r<0&&(r=0);let o=i[r];for(;this.isItemExpanded(o)&&this.getNavigableChildrenIds(o).length>0;)o=this.getNavigableChildrenIds(o).pop();return o}getTreeViewItemOptions(){return{multiSelection:this.multiSelection,checkboxSelection:this.checkboxSelection,multiCheckboxSelection:this.multiCheckboxSelection,size:this.size,borderless:this.borderless,disableTabbing:this.disableTabbing,draggable:this.enableReordering,getLevel:e=>this.getLevel(e),hasItemFocus:e=>this.isItemInFocus(e),hasItemSelected:e=>this.isItemSelected(e),hasItemDisabled:e=>this.isItemDisabled(e),hasItemExpanded:e=>this.isItemExpanded(e),hasItemChecked:e=>this.isItemChecked(e),hasItemIndeterminate:e=>this.isItemIndeterminate(e),showSelectionIndicator:e=>this.showSelectionIndicator(e),onItemSelection:(e,t)=>this.handleItemSelection(e,t),onCheckboxSelection:(e,t)=>this.handleCheckboxSelection(e,t),onItemExpandToggle:e=>this.handleItemExpand(e),onItemFocus:e=>this.handleItemFocus(e),onItemAdd:e=>this.addItem(e),onItemDelete:e=>this.deleteItem(e),onItemUpdate:(e,t)=>this.updateItem(e,t),onItemDrag:(e,t,s)=>this.handleItemDragStart(e,t,s),onItemDragClick:(e,t,s)=>this.handleItemDragStartKeyboard(e,t,s)}}handleCheckboxSelection(e,t=!1){if(this.items[e].disabled)return;let s=!this.isItemChecked(e),i=[...this.checkedItems],n=[...this.checkedItems,e];if(this.multiCheckboxSelection){if(t){const o=this.getChildrenIds(e,!1);s=o.filter(a=>i.includes(a)).length===o.length,s?i.push(e):i=i.filter(a=>a!==e)}else{const o=this.getChildrenIds(e,!0);s?i.push(e,...o):i=i.filter(d=>d!==e).filter(d=>!o.includes(d)),n.push(...o)}const r=this.getParentIds(e);r.forEach(o=>{const d=this.getChildrenIds(o,!1);d.filter(l=>i.includes(l)).length===d.length?i.push(o):i=i.filter(l=>l!==o)}),n.push(...r)}else i=s?[e]:[];this.checkedItems=[...i],this.syncItems.push(...n,...i)}handleItemAdded(e){this.addItem(e.detail),e.preventDefault(),e.stopPropagation()}handleItemClick(e){const t=e.detail.actionId,s=e.target.getAttribute("node-id");this.itemActionClick.emit({actionId:t,nodeId:s})}handleItemExpand(e){const{children:t}=this.items[e];if(!(t&&t.length))return;const s=!this.isItemExpanded(e);let i=[...this.expandedItems];s?i.push(e):i=i.filter(n=>n!==e),this.expandedItems=[...i],this.syncItems.push(e)}handleItemFocus(e){const{element:t}=this.items[e];this.focusItem=e,t.focusItem()}handleChangeTreeitem(e,t){this.itemSelectionChange.emit({isSelected:e,nodeId:t})}handleItemSelection(e,t){if(this.items[e].disabled)return;const s=t instanceof MouseEvent&&t.shiftKey,i=this.multiSelection&&t&&(t.shiftKey||t.ctrlKey||t.metaKey),n=!this.isItemSelected(e);if(!s)this.anchorItemId=e;else{this.updateClickedItems(e,!0);return}const r=[...this.selectedItems];let o=[...this.selectedItems];n?i?(o.push(e),this.handleChangeTreeitem(!0,e)):o=[e]:(o=o.filter(d=>d!==e),i&&this.handleChangeTreeitem(!1,e)),this.selectedItems=[...o],this.syncItems.push(...r,...o)}handleKeyDown(e){if(e.defaultPrevented||e.altKey)return;const t=e.code.toUpperCase();let s=!1;if(!this.isDraggingWithKeyboard)switch(t){case"SPACE":this.focusItem&&(this.handleItemExpand(this.focusItem),s=!0);break;case"ENTER":this.focusItem&&(this.handleItemSelection(this.focusItem,e),e.stopPropagation());break;case"ARROWDOWN":const i=this.focusItem?this.getNextNavigableItem(this.focusItem):this.getFirstItem();this.multiSelection&&e.shiftKey&&this.isItemSelected(this.focusItem)&&(this.isItemSelected(i)?this.handleItemSelection(this.focusItem,e):this.handleItemSelection(i,e)),this.handleItemFocus(i),s=!0;break;case"ARROWUP":const n=this.focusItem?this.getPrevNavigableItem(this.focusItem):this.getLastItem();this.multiSelection&&e.shiftKey&&this.isItemSelected(this.focusItem)&&(this.isItemSelected(n)?this.handleItemSelection(this.focusItem,e):this.handleItemSelection(n,e)),this.handleItemFocus(n),s=!0;break;case"ARROWRIGHT":if(this.focusItem)if(this.disableTabbing&&e.shiftKey){const{element:r}=this.items[this.focusItem];r.focusCheckbox()}else this.isItemExpanded(this.focusItem)||this.handleItemExpand(this.focusItem);break;case"ARROWLEFT":this.focusItem&&this.isItemExpanded(this.focusItem)&&this.handleItemExpand(this.focusItem);break;case"TAB":this.disableTabbing&&this.resetFocusItem();break}s&&(e.preventDefault(),e.stopPropagation())}updateClickedItems(e,t){const s=Object.keys(this.items);if(this.multiSelection&&t){this.anchorItemId===null&&(this.anchorItemId=e);const n=s.indexOf(this.anchorItemId),r=s.indexOf(e),o=Math.min(n,r),d=Math.max(n,r);this.selectedItems=s.slice(o,d+1),this.syncItems.push(...this.selectedItems);return}const i=this.isItemSelected(e);i||(this.anchorItemId=e),this.selectedItems=i?this.selectedItems.filter(n=>n!==e):[e],this.syncItems.push(...this.selectedItems)}isItemChecked(e){return this.checkedItems.includes(e)}isItemExpanded(e){return this.expandedItems.includes(e)}isItemInFocus(e){return this.focusItem===e}isItemSelected(e){return this.selectedItems.includes(e)}isItemIndeterminate(e){const t=this.getChildrenIds(e);if(t&&this.multiCheckboxSelection){const s=t.filter(i=>this.isItemChecked(i));return s.length>0&&s.length<t.length}return!1}isItemDisabled(e){const{disabled:t}=this.items[e],s=this.getParentIds(e);return t||!!(s!=null&&s.find(i=>this.items[i].disabled))}resetFocusItem(){this.focusItem=null}showSelectionIndicator(e){return this.isItemSelected(e)||!this.isItemExpanded(e)&&!!this.getChildrenIds(e,!0).find(t=>this.isItemSelected(t))}syncTreeViewItem(e){var t,s;(s=(t=this.items[e])===null||t===void 0?void 0:t.element)===null||s===void 0||s.updateComponent()}updateItem(e,t){var s;let i;t&&e.nodeId!==t.nodeId?(i=Object.assign({},this.items[t.nodeId]),delete this.items[t.nodeId]):i=Object.assign({},this.items[e.nodeId]),i.nodeId?(this.items[e.nodeId]=Object.assign(Object.assign({},i),e),(s=e.children)===null||s===void 0||s.forEach(n=>{const r=this.items[n];this.items[n]=Object.assign(Object.assign({},r),{parentId:e.nodeId})})):this.items[e.nodeId]=Object.assign({},e)}render(){return h(g,{key:"8f3612230fd3eabd0b06e0fff972defc8a77745b"},h("ul",{key:"663ea4ab53a25618226649a61014c0b0385109a7",role:"tree",tabindex:this.disableTabbing?0:null,onKeyDown:e=>this.handleKeyDown(e)},h("slot",{key:"1f30b5548cb1a2defa0faefe1f99da7b2dc59bb0",onSlotchange:()=>this.handleTreeSlotChange()})),h(p,{key:"56a14e7456ad2019ef4d8d21900181f6c654c7a4",draggingState:this.itemDragState},h("div",{key:"ab4f7d792b3420a835ae431adf28a6fd1c33dee2",class:"drag-indicator",tabIndex:-1})))}get element(){return u(this)}static get watchers(){return{itemDragState:["handleItemDragState"],isDraggingWithKeyboard:["handleDraggingWithKeyboard"],expandedItems:["handleItemsProps"],selectedItems:["handleItemsProps"],checkedItems:["handleItemsProps"],checkboxSelection:["handleOptionsProps"],disableTabbing:["handleOptionsProps"],multiCheckboxSelection:["handleOptionsProps"],multiSelection:["handleOptionsProps"],size:["handleOptionsProps"],borderless:["handleOptionsProps"],enableReordering:["handleOptionsProps"]}}};v.style=S;export{v as modus_tree_view};
